import{_ as D,r as b,m as T,x as L,o as U,j as V,e as E,f as I,g as h,h as l,a as t,w as O,c as x,d as R,b as C,y as q,n as z,A as H,t as _,F as M,v as F,i as N}from"./index-Dp99rAEB.js";import{S as A}from"./SpinnerIcon-DzWrYR0L.js";import{B as G}from"./BriefcaseIcon-C992-8GF.js";import{A as J,D as K,E as Q}from"./ActionButton-DShL_DGw.js";import{B as W,M as X,C as Y,a as Z,T as $}from"./BaseCheckbox-DEjJRfAJ.js";import{B as ee}from"./BaseInput-CxIbUHHE.js";import"./RippleEffect-WDp0XzxJ.js";import"./LogoutIcon-BEAykltr.js";const te={name:"RoleModal",components:{ModalInterface:X,BaseInput:ee,BaseCheckbox:W,SpinnerIcon:A},props:{show:{type:Boolean,default:!1},role:{type:Object,default:null}},emits:["close","saved"],setup(n,{emit:a}){const p=b(!1),e=b([]),u=b({}),v=b({}),d=b({name:"",display_name:"",description:""}),c=T(()=>!!n.role),k=T(()=>d.value.name.trim()&&d.value.display_name.trim()),P=T(()=>[...new Set(e.value.map(r=>r.category).filter(Boolean))].sort()),f=s=>e.value.filter(r=>r.category===s),w=(s,r)=>{u.value={...u.value,[s]:r}},o=async()=>{var s;try{const r=await I.get("/permissions");if(r.success){e.value=r.data.data;const y={};e.value.forEach(S=>{y[S.id]=!1}),u.value=y,(s=n.role)!=null&&s.id&&c.value&&await m()}}catch(r){console.error("Failed to load permissions:",r)}},m=async()=>{var s;if((s=n.role)!=null&&s.id)try{const r=await I.get(`/roles/${n.role.id}`);if(r.success&&r.data.permissions){const y={...u.value};r.data.permissions.forEach(S=>{y.hasOwnProperty(S.id)&&(y[S.id]=!0)}),u.value=y}}catch(r){console.error("Failed to load role permissions:",r)}},i=()=>{if(d.value={name:"",display_name:"",description:""},v.value={},e.value.length>0){const s={};e.value.forEach(r=>{s[r.id]=!1}),u.value=s}},g=()=>{n.role&&(d.value={name:n.role.name||"",display_name:n.role.display_name||"",description:n.role.description||""})},B=()=>{i(),a("close")},j=async()=>{if(k.value){p.value=!0,v.value={};try{const s={name:d.value.name.toLowerCase().replace(/[^a-z0-9_]/g,"_"),display_name:d.value.display_name,description:d.value.description||null},r=Object.keys(u.value).filter(S=>u.value[S]);s.permissions=r;let y;if(c.value?y=await I.put(`/roles/${n.role.id}`,s):y=await I.post("/roles",s),y.success)a("saved",y.data),B();else if(y.errors)v.value=y.errors;else throw new Error(y.message||"Failed to save role")}catch(s){console.error("Error saving role:",s),v.value={general:s.message||"Failed to save role"}}finally{p.value=!1}}};return L(()=>[n.show,n.role],async([s,r])=>{s?(await o(),g(),r!=null&&r.id&&c.value&&await m()):i()},{immediate:!0,deep:!0}),U(()=>{n.show&&(o(),g())}),{loading:p,permissions:e,selectedPermissions:u,errors:v,form:d,isEditing:c,isFormValid:k,permissionCategories:P,getPermissionsByCategory:f,updatePermission:w,handleClose:B,handleSubmit:j}}},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},re={key:0},se={class:"space-y-4 max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg p-5"},le={class:"text-sm font-medium text-gray-700 dark:text-gray-300 capitalize border-b border-gray-200 dark:border-gray-700 pb-2"},ne={class:"grid grid-cols-1 lg:grid-cols-2 gap-3"},ie={key:0,class:"space-y-3"},de={class:"grid grid-cols-1 lg:grid-cols-2 gap-3"},ce={key:1,class:"p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg"},me={class:"flex justify-end space-x-3"},ge=["disabled"];function ue(n,a,p,e,u,v){const d=h("BaseInput"),c=h("BaseCheckbox"),k=h("SpinnerIcon"),P=h("ModalInterface");return l(),V(P,{show:p.show,title:e.isEditing?"Edit Role":"Create Role",subtitle:e.isEditing?"Modify role settings and permissions":"Create a new role with specific permissions",size:"xl",onClose:e.handleClose},{footer:E(()=>[t("div",me,[t("button",{type:"button",onClick:a[4]||(a[4]=(...f)=>e.handleClose&&e.handleClose(...f)),class:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 transition-colors"}," Cancel "),t("button",{onClick:a[5]||(a[5]=(...f)=>e.handleSubmit&&e.handleSubmit(...f)),disabled:!e.isFormValid||e.loading,class:"px-4 py-2 text-sm font-medium text-white bg-brand-600 border border-transparent rounded-lg hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center"},[e.loading?(l(),V(k,{key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4"})):R("",!0),N(" "+_(e.isEditing?"Update Role":"Create Role"),1)],8,ge)])]),default:E(()=>{var f,w;return[t("form",{onSubmit:a[3]||(a[3]=O((...o)=>e.handleSubmit&&e.handleSubmit(...o),["prevent"])),class:"space-y-5"},[t("div",ae,[t("div",null,[a[6]||(a[6]=t("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"}," Role Name * ",-1)),C(d,{modelValue:e.form.name,"onUpdate:modelValue":a[0]||(a[0]=o=>e.form.name=o),type:"text",placeholder:"e.g., manager",error:e.errors.name,disabled:e.isEditing&&((f=p.role)==null?void 0:f.is_system),required:""},null,8,["modelValue","error","disabled"]),a[7]||(a[7]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Internal identifier ",-1))]),t("div",null,[a[8]||(a[8]=t("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"}," Display Name * ",-1)),C(d,{modelValue:e.form.display_name,"onUpdate:modelValue":a[1]||(a[1]=o=>e.form.display_name=o),type:"text",placeholder:"e.g., Manager",error:e.errors.display_name,required:""},null,8,["modelValue","error"]),a[9]||(a[9]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Human-readable name ",-1))])]),t("div",null,[a[10]||(a[10]=t("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"}," Description ",-1)),q(t("textarea",{"onUpdate:modelValue":a[2]||(a[2]=o=>e.form.description=o),rows:"2",class:z(["w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-700 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-colors resize-none",e.errors.description?"border-red-300 focus:border-red-500 focus:ring-red-500":""]),placeholder:"Describe what this role can do..."},null,2),[[H,e.form.description]]),e.errors.description?(l(),x("p",oe,_(e.errors.description),1)):R("",!0)]),e.permissions.length>0?(l(),x("div",re,[a[12]||(a[12]=t("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-3"}," Permissions ",-1)),t("div",se,[(l(!0),x(M,null,F(e.permissionCategories,o=>(l(),x("div",{key:o,class:"space-y-3"},[t("h4",le,_(o.replace("_"," ")),1),t("div",ne,[(l(!0),x(M,null,F(e.getPermissionsByCategory(o),m=>(l(),V(c,{key:m.id,id:`permission-${m.id}`,modelValue:e.selectedPermissions[m.id],"onUpdate:modelValue":i=>e.updatePermission(m.id,i),label:m.display_name,help:m.description},null,8,["id","modelValue","onUpdate:modelValue","label","help"]))),128))])]))),128)),e.getPermissionsByCategory(null).length>0?(l(),x("div",ie,[a[11]||(a[11]=t("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700 pb-2"}," Other ",-1)),t("div",de,[(l(!0),x(M,null,F(e.getPermissionsByCategory(null),o=>(l(),V(c,{key:o.id,id:`permission-${o.id}`,modelValue:e.selectedPermissions[o.id],"onUpdate:modelValue":m=>e.updatePermission(o.id,m),label:o.display_name,help:o.description},null,8,["id","modelValue","onUpdate:modelValue","label","help"]))),128))])])):R("",!0)])])):R("",!0),e.isEditing&&((w=p.role)!=null&&w.is_system)?(l(),x("div",ce,a[13]||(a[13]=[t("div",{class:"flex"},[t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])]),t("div",{class:"ml-3"},[t("p",{class:"text-sm text-amber-800 dark:text-amber-200"}," This is a system role. Some fields may be restricted to prevent system issues. ")])],-1)]))):R("",!0)],32)]}),_:1},8,["show","title","subtitle","onClose"])}const ye=D(te,[["render",ue]]),xe={name:"Roles",components:{SpinnerIcon:A,BriefcaseIcon:G,EditIcon:Q,DeleteIcon:K,ActionButton:J,RoleModal:ye,TablePagination:$,BaseTable:Z,CreateButton:Y},setup(){const n=b([]),a=b(!1),p=b(null),e=b(null),u=b(10),v=b(!1),d=b(null),c=async(i=1)=>{a.value=!0,p.value=null;try{const g=new URLSearchParams({page:i.toString(),limit:u.value.toString()}),B=await I.get(`/roles?${g}`);if(B.success)n.value=B.data.data,e.value=B.data.pagination;else throw new Error(B.message||"Failed to load roles")}catch(g){console.error("Error loading roles:",g),p.value=g.message||"Failed to load roles",n.value=[],e.value=null}finally{a.value=!1}},k=i=>{var g;i!==((g=e.value)==null?void 0:g.page)&&c(i)},P=i=>{u.value=i,c(1)},f=async()=>{await c()},w=i=>{d.value=i},o=async i=>{if(confirm(`Are you sure you want to delete the role "${i.display_name}"?`))try{const g=await I.delete(`/roles/${i.id}`);if(g.success)await c();else throw new Error(g.message||"Failed to delete role")}catch(g){console.error("Error deleting role:",g),alert(g.message||"Failed to delete role")}},m=()=>{v.value=!1,d.value=null};return U(()=>{c()}),{roles:n,loading:a,error:p,pagination:e,perPage:u,showCreateRole:v,editingRole:d,loadRoles:c,changePage:k,handlePerPageChange:P,handleRoleSaved:f,editRole:w,deleteRole:o,closeModal:m}}},pe={class:"space-y-6"},fe={class:"flex justify-end items-center"},be={class:"px-6 py-4 whitespace-nowrap"},ve={class:"flex items-center"},he={class:"text-sm font-medium text-gray-900 dark:text-white"},ke={class:"text-sm text-gray-500 dark:text-gray-400"},_e={class:"px-6 py-4"},we={class:"text-sm text-gray-900 dark:text-white"},Ce={class:"px-6 py-4"},Pe={class:"text-sm text-gray-900 dark:text-white"},Be={class:"px-6 py-4"},Re={class:"text-sm text-gray-900 dark:text-white"},Se={class:"px-6 py-4 whitespace-nowrap"},Ve={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ee={key:0,class:"flex items-center space-x-2"},Ie={key:1,class:"text-xs text-gray-400 dark:text-gray-500"};function Me(n,a,p,e,u,v){const d=h("CreateButton"),c=h("BriefcaseIcon"),k=h("ActionButton"),P=h("BaseTable"),f=h("TablePagination"),w=h("RoleModal");return l(),x("div",pe,[t("div",fe,[C(d,{onClick:a[0]||(a[0]=o=>e.showCreateRole=!0)},{default:E(()=>a[1]||(a[1]=[N(" Create Role ")])),_:1,__:[1]})]),C(P,{data:e.roles,loading:e.loading,error:e.error,"loading-text":"Loading roles...","error-title":"Failed to load roles",onRetry:e.loadRoles},{header:E(()=>a[2]||(a[2]=[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Role "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Description "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Permissions "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Users "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Type "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Actions ")],-1)])),body:E(()=>[(l(!0),x(M,null,F(e.roles,o=>{var m;return l(),x("tr",{key:o.id,class:"odd:bg-gray-50 odd:dark:bg-gray-700 even:bg-white even:dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-600"},[t("td",be,[t("div",ve,[C(c,{class:"w-5 h-5 text-gray-400 mr-3"}),t("div",null,[t("div",he,_(o.display_name),1),t("div",ke,_(o.name),1)])])]),t("td",_e,[t("div",we,_(o.description||"No description"),1)]),t("td",Ce,[t("div",Pe,_(((m=o.permissions)==null?void 0:m.length)||0),1)]),t("td",Be,[t("div",Re,_(o.user_count||0),1)]),t("td",Se,[t("span",{class:z([o.is_system?"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400":"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400","inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},_(o.is_system?"System":"Custom"),3)]),t("td",Ve,[o.is_system?(l(),x("div",Ie," System role ")):(l(),x("div",Ee,[C(k,{variant:"edit",title:"Edit role",icon:"EditIcon",onClick:i=>e.editRole(o)},null,8,["onClick"]),o.user_count===0?(l(),V(k,{key:0,variant:"delete",title:"Delete role (only available when no users are assigned)",icon:"DeleteIcon",onClick:i=>e.deleteRole(o)},null,8,["onClick"])):R("",!0)]))])])}),128))]),empty:E(()=>[C(c,{class:"mx-auto h-12 w-12 text-gray-400"}),a[3]||(a[3]=t("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"No roles found",-1)),a[4]||(a[4]=t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Create a role to get started. ",-1))]),_:1},8,["data","loading","error","onRetry"]),e.pagination?(l(),V(f,{key:0,pagination:e.pagination,"per-page":e.perPage,onPageChange:e.changePage,onPerPageChange:e.handlePerPageChange},null,8,["pagination","per-page","onPageChange","onPerPageChange"])):R("",!0),C(w,{show:e.showCreateRole||!!e.editingRole,role:e.editingRole,onClose:e.closeModal,onSaved:e.handleRoleSaved},null,8,["show","role","onClose","onSaved"])])}const Le=D(xe,[["render",Me]]);export{Le as default};
