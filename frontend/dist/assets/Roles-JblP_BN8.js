import{_ as T,m as I,o as j,B as K,j as V,b as _,e as R,T as N,C as G,h as r,c as i,d as b,a,w as O,n as D,l as U,t as v,x as q,D as J,i as L,r as w,E as Q,f as M,g as C,z as W,F as z,v as F}from"./index-Dd5TzPSX.js";import{S as A}from"./SpinnerIcon-BMtDvVyB.js";import{B as X}from"./BriefcaseIcon-CY9_fvs8.js";import{A as Y,D as Z,E as $}from"./ActionButton-DmeIiOdQ.js";import{B as ee}from"./BaseInput-BL2JbYwr.js";import{B as te,T as ae}from"./BaseTable-ClE-9u2E.js";import"./RippleEffect-Bft_pb-i.js";import"./LogoutIcon-6BZbfSok.js";const oe={name:"ModalInterface",props:{show:{type:Boolean,default:!1},title:{type:String,default:""},subtitle:{type:String,default:""},size:{type:String,default:"md",validator:o=>["xs","sm","md","lg","xl","2xl"].includes(o)},showCloseButton:{type:Boolean,default:!0},closeOnBackdrop:{type:Boolean,default:!0},closeOnEscape:{type:Boolean,default:!0}},emits:["close"],setup(o,{emit:t}){const s=I(()=>({xs:"max-w-xs w-full",sm:"max-w-sm w-full",md:"max-w-md w-full",lg:"max-w-lg w-full",xl:"max-w-xl w-full","2xl":"max-w-2xl w-full"})[o.size]),e=()=>{t("close")},u=()=>{o.closeOnBackdrop&&e()},g=m=>{m.key==="Escape"&&o.closeOnEscape&&o.show&&e()};return j(()=>{document.addEventListener("keydown",g),o.show&&(document.body.style.overflow="hidden")}),K(()=>{document.removeEventListener("keydown",g),document.body.style.overflow=""}),{sizeClasses:s,handleClose:e,handleBackdropClick:u,handleBodyScroll:()=>{o.show?document.body.style.overflow="hidden":document.body.style.overflow=""}}},watch:{show:{handler:"handleBodyScroll",immediate:!0}}},se={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},re={class:"flex min-h-full items-center justify-center p-4 py-8"},le={key:0,class:"px-6 py-5 border-b border-gray-200/50 dark:border-gray-700/50 flex-shrink-0"},ne={class:"flex items-center justify-between"},de={class:"text-xl font-semibold text-gray-900 dark:text-white"},ie={key:0,class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},ce={class:"px-6 py-6 flex-1 overflow-y-auto"},me={key:1,class:"px-6 py-4 bg-gray-50/50 dark:bg-gray-700/30 border-t border-gray-200/50 dark:border-gray-700/50 rounded-b-2xl flex-shrink-0"};function ue(o,t,s,e,u,g){return r(),V(G,{to:"body"},[_(N,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:R(()=>[s.show?(r(),i("div",se,[a("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:t[0]||(t[0]=(...n)=>e.handleBackdropClick&&e.handleBackdropClick(...n))}),a("div",re,[_(N,{"enter-active-class":"duration-300 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-4","enter-to-class":"opacity-100 scale-100 translate-y-0","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100 scale-100 translate-y-0","leave-to-class":"opacity-0 scale-95 translate-y-4"},{default:R(()=>[s.show?(r(),i("div",{key:0,class:D(["relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl transform transition-all","border border-gray-200/50 dark:border-gray-700/50","max-h-[85vh] flex flex-col",e.sizeClasses]),onClick:t[2]||(t[2]=O(()=>{},["stop"]))},[o.$slots.header||s.title?(r(),i("div",le,[a("div",ne,[a("div",null,[U(o.$slots,"header",{},()=>[a("h2",de,v(s.title),1),s.subtitle?(r(),i("p",ie,v(s.subtitle),1)):b("",!0)])]),s.showCloseButton?(r(),i("button",{key:0,onClick:t[1]||(t[1]=(...n)=>e.handleClose&&e.handleClose(...n)),class:"p-2 -mr-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700"},t[3]||(t[3]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):b("",!0)])])):b("",!0),a("div",ce,[U(o.$slots,"default")]),o.$slots.footer?(r(),i("div",me,[U(o.$slots,"footer")])):b("",!0)],2)):b("",!0)]),_:3})])])):b("",!0)]),_:3})])}const ge=T(oe,[["render",ue]]),ye={name:"BaseCheckbox",props:{modelValue:{type:Boolean,default:!1},id:{type:String,default:()=>`checkbox-${Math.random().toString(36).substr(2,9)}`},label:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},error:{type:String,default:""},help:{type:String,default:""}},emits:["update:modelValue"],computed:{value:{get(){return this.modelValue},set(o){this.$emit("update:modelValue",o)}},checkboxClasses(){return["h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-brand-600 focus:ring-brand-500 dark:bg-gray-700 dark:focus:ring-brand-600 transition-colors",this.error&&"border-red-300 dark:border-red-600 text-red-600 focus:ring-red-500",this.disabled&&"opacity-50 cursor-not-allowed"].filter(Boolean).join(" ")}}},fe={class:"space-y-1"},xe={class:"flex items-center"},be=["id","required","disabled"],he=["for"],pe={key:0,class:"text-red-500"},ve={key:0,class:"text-sm text-red-600 dark:text-red-400"},ke={key:1,class:"text-sm text-gray-500 dark:text-gray-400"};function we(o,t,s,e,u,g){return r(),i("div",fe,[a("div",xe,[q(a("input",{id:s.id,"onUpdate:modelValue":t[0]||(t[0]=n=>g.value=n),type:"checkbox",required:s.required,disabled:s.disabled,class:D(g.checkboxClasses)},null,10,be),[[J,g.value]]),s.label?(r(),i("label",{key:0,for:s.id,class:"ml-2 block text-sm text-gray-900 dark:text-white"},[L(v(s.label)+" ",1),s.required?(r(),i("span",pe,"*")):b("",!0)],8,he)):b("",!0)]),s.error?(r(),i("p",ve,v(s.error),1)):b("",!0),s.help?(r(),i("p",ke,v(s.help),1)):b("",!0)])}const _e=T(ye,[["render",we]]),Ce={name:"RoleModal",components:{ModalInterface:ge,BaseInput:ee,BaseCheckbox:_e,SpinnerIcon:A},props:{show:{type:Boolean,default:!1},role:{type:Object,default:null}},emits:["close","saved"],setup(o,{emit:t}){const s=w(!1),e=w([]),u=w({}),g=w({}),n=w({name:"",display_name:"",description:""}),m=I(()=>!!o.role),B=I(()=>n.value.name.trim()&&n.value.display_name.trim()),S=I(()=>[...new Set(e.value.map(d=>d.category).filter(Boolean))].sort()),k=c=>e.value.filter(d=>d.category===c),y=(c,d)=>{u.value={...u.value,[c]:d}},l=async()=>{var c;try{const d=await M.get("/permissions");if(d.success){e.value=d.data.data;const p={};e.value.forEach(E=>{p[E.id]=!1}),u.value=p,(c=o.role)!=null&&c.id&&m.value&&await h()}}catch(d){console.error("Failed to load permissions:",d)}},h=async()=>{var c;if((c=o.role)!=null&&c.id)try{const d=await M.get(`/roles/${o.role.id}`);if(d.success&&d.data.permissions){const p={...u.value};d.data.permissions.forEach(E=>{p.hasOwnProperty(E.id)&&(p[E.id]=!0)}),u.value=p}}catch(d){console.error("Failed to load role permissions:",d)}},f=()=>{if(n.value={name:"",display_name:"",description:""},g.value={},e.value.length>0){const c={};e.value.forEach(d=>{c[d.id]=!1}),u.value=c}},x=()=>{o.role&&(n.value={name:o.role.name||"",display_name:o.role.display_name||"",description:o.role.description||""})},P=()=>{f(),t("close")},H=async()=>{if(B.value){s.value=!0,g.value={};try{const c={name:n.value.name.toLowerCase().replace(/[^a-z0-9_]/g,"_"),display_name:n.value.display_name,description:n.value.description||null},d=Object.keys(u.value).filter(E=>u.value[E]);c.permissions=d;let p;if(m.value?p=await M.put(`/roles/${o.role.id}`,c):p=await M.post("/roles",c),p.success)t("saved",p.data),P();else if(p.errors)g.value=p.errors;else throw new Error(p.message||"Failed to save role")}catch(c){console.error("Error saving role:",c),g.value={general:c.message||"Failed to save role"}}finally{s.value=!1}}};return Q(()=>[o.show,o.role],async([c,d])=>{c?(await l(),x(),d!=null&&d.id&&m.value&&await h()):f()},{immediate:!0,deep:!0}),j(()=>{o.show&&(l(),x())}),{loading:s,permissions:e,selectedPermissions:u,errors:g,form:n,isEditing:m,isFormValid:B,permissionCategories:S,getPermissionsByCategory:k,updatePermission:y,handleClose:P,handleSubmit:H}}},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Se={key:0,class:"mt-1 text-sm text-red-600 dark:text-red-400"},Pe={key:0},Re={class:"space-y-4 max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg p-5"},Ee={class:"text-sm font-medium text-gray-700 dark:text-gray-300 capitalize border-b border-gray-200 dark:border-gray-700 pb-2"},Ve={class:"grid grid-cols-1 lg:grid-cols-2 gap-3"},Me={key:0,class:"space-y-3"},Ie={class:"grid grid-cols-1 lg:grid-cols-2 gap-3"},ze={key:1,class:"p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg"},Fe={class:"flex justify-end space-x-3"},Te=["disabled"];function De(o,t,s,e,u,g){const n=C("BaseInput"),m=C("BaseCheckbox"),B=C("SpinnerIcon"),S=C("ModalInterface");return r(),V(S,{show:s.show,title:e.isEditing?"Edit Role":"Create Role",subtitle:e.isEditing?"Modify role settings and permissions":"Create a new role with specific permissions",size:"xl",onClose:e.handleClose},{footer:R(()=>[a("div",Fe,[a("button",{type:"button",onClick:t[4]||(t[4]=(...k)=>e.handleClose&&e.handleClose(...k)),class:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 transition-colors"}," Cancel "),a("button",{onClick:t[5]||(t[5]=(...k)=>e.handleSubmit&&e.handleSubmit(...k)),disabled:!e.isFormValid||e.loading,class:"px-4 py-2 text-sm font-medium text-white bg-brand-600 border border-transparent rounded-lg hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center"},[e.loading?(r(),V(B,{key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4"})):b("",!0),L(" "+v(e.isEditing?"Update Role":"Create Role"),1)],8,Te)])]),default:R(()=>{var k,y;return[a("form",{onSubmit:t[3]||(t[3]=O((...l)=>e.handleSubmit&&e.handleSubmit(...l),["prevent"])),class:"space-y-5"},[a("div",Be,[a("div",null,[t[6]||(t[6]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"}," Role Name * ",-1)),_(n,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.form.name=l),type:"text",placeholder:"e.g., manager",error:e.errors.name,disabled:e.isEditing&&((k=s.role)==null?void 0:k.is_system),required:""},null,8,["modelValue","error","disabled"]),t[7]||(t[7]=a("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Internal identifier ",-1))]),a("div",null,[t[8]||(t[8]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"}," Display Name * ",-1)),_(n,{modelValue:e.form.display_name,"onUpdate:modelValue":t[1]||(t[1]=l=>e.form.display_name=l),type:"text",placeholder:"e.g., Manager",error:e.errors.display_name,required:""},null,8,["modelValue","error"]),t[9]||(t[9]=a("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Human-readable name ",-1))])]),a("div",null,[t[10]||(t[10]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"}," Description ",-1)),q(a("textarea",{"onUpdate:modelValue":t[2]||(t[2]=l=>e.form.description=l),rows:"2",class:D(["w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-700 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-colors resize-none",e.errors.description?"border-red-300 focus:border-red-500 focus:ring-red-500":""]),placeholder:"Describe what this role can do..."},null,2),[[W,e.form.description]]),e.errors.description?(r(),i("p",Se,v(e.errors.description),1)):b("",!0)]),e.permissions.length>0?(r(),i("div",Pe,[t[12]||(t[12]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-3"}," Permissions ",-1)),a("div",Re,[(r(!0),i(z,null,F(e.permissionCategories,l=>(r(),i("div",{key:l,class:"space-y-3"},[a("h4",Ee,v(l.replace("_"," ")),1),a("div",Ve,[(r(!0),i(z,null,F(e.getPermissionsByCategory(l),h=>(r(),V(m,{key:h.id,id:`permission-${h.id}`,modelValue:e.selectedPermissions[h.id],"onUpdate:modelValue":f=>e.updatePermission(h.id,f),label:h.display_name,help:h.description},null,8,["id","modelValue","onUpdate:modelValue","label","help"]))),128))])]))),128)),e.getPermissionsByCategory(null).length>0?(r(),i("div",Me,[t[11]||(t[11]=a("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700 pb-2"}," Other ",-1)),a("div",Ie,[(r(!0),i(z,null,F(e.getPermissionsByCategory(null),l=>(r(),V(m,{key:l.id,id:`permission-${l.id}`,modelValue:e.selectedPermissions[l.id],"onUpdate:modelValue":h=>e.updatePermission(l.id,h),label:l.display_name,help:l.description},null,8,["id","modelValue","onUpdate:modelValue","label","help"]))),128))])])):b("",!0)])])):b("",!0),e.isEditing&&((y=s.role)!=null&&y.is_system)?(r(),i("div",ze,t[13]||(t[13]=[a("div",{class:"flex"},[a("div",{class:"flex-shrink-0"},[a("svg",{class:"h-5 w-5 text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])]),a("div",{class:"ml-3"},[a("p",{class:"text-sm text-amber-800 dark:text-amber-200"}," This is a system role. Some fields may be restricted to prevent system issues. ")])],-1)]))):b("",!0)],32)]}),_:1},8,["show","title","subtitle","onClose"])}const Ue=T(Ce,[["render",De]]),je={name:"Roles",components:{SpinnerIcon:A,BriefcaseIcon:X,EditIcon:$,DeleteIcon:Z,ActionButton:Y,RoleModal:Ue,TablePagination:ae,BaseTable:te},setup(){const o=w([]),t=w(!1),s=w(null),e=w(null),u=w(10),g=w(!1),n=w(null),m=async(f=1)=>{t.value=!0,s.value=null;try{const x=new URLSearchParams({page:f.toString(),limit:u.value.toString()}),P=await M.get(`/roles?${x}`);if(P.success)o.value=P.data.data,e.value=P.data.pagination;else throw new Error(P.message||"Failed to load roles")}catch(x){console.error("Error loading roles:",x),s.value=x.message||"Failed to load roles",o.value=[],e.value=null}finally{t.value=!1}},B=f=>{var x;f!==((x=e.value)==null?void 0:x.page)&&m(f)},S=f=>{u.value=f,m(1)},k=async()=>{await m()},y=f=>{n.value=f},l=async f=>{if(confirm(`Are you sure you want to delete the role "${f.display_name}"?`))try{const x=await M.delete(`/roles/${f.id}`);if(x.success)await m();else throw new Error(x.message||"Failed to delete role")}catch(x){console.error("Error deleting role:",x),alert(x.message||"Failed to delete role")}},h=()=>{g.value=!1,n.value=null};return j(()=>{m()}),{roles:o,loading:t,error:s,pagination:e,perPage:u,showCreateRole:g,editingRole:n,loadRoles:m,changePage:B,handlePerPageChange:S,handleRoleSaved:k,editRole:y,deleteRole:l,closeModal:h}}},Ne={class:"space-y-6"},Oe={class:"flex justify-between items-center"},qe={class:"px-6 py-4 whitespace-nowrap"},Le={class:"flex items-center"},Ae={class:"text-sm font-medium text-gray-900 dark:text-white"},He={class:"text-sm text-gray-500 dark:text-gray-400"},Ke={class:"px-6 py-4"},Ge={class:"text-sm text-gray-900 dark:text-white"},Je={class:"px-6 py-4"},Qe={class:"text-sm text-gray-900 dark:text-white"},We={class:"px-6 py-4 whitespace-nowrap"},Xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ye={key:0,class:"flex items-center space-x-2"},Ze={key:1,class:"text-xs text-gray-400 dark:text-gray-500"};function $e(o,t,s,e,u,g){const n=C("BriefcaseIcon"),m=C("ActionButton"),B=C("BaseTable"),S=C("TablePagination"),k=C("RoleModal");return r(),i("div",Ne,[a("div",Oe,[t[1]||(t[1]=a("div",null,[a("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Role Management"),a("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Manage user roles and permissions ")],-1)),a("button",{onClick:t[0]||(t[0]=y=>e.showCreateRole=!0),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 transition-colors duration-200"}," Create Role ")]),_(B,{data:e.roles,loading:e.loading,error:e.error,"loading-text":"Loading roles...","error-title":"Failed to load roles",onRetry:e.loadRoles},{header:R(()=>t[2]||(t[2]=[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Role "),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Description "),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Permissions "),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Type "),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Actions ")],-1)])),body:R(()=>[(r(!0),i(z,null,F(e.roles,y=>{var l;return r(),i("tr",{key:y.id,class:"odd:bg-gray-50 odd:dark:bg-gray-700 even:bg-white even:dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"},[a("td",qe,[a("div",Le,[_(n,{class:"w-5 h-5 text-gray-400 mr-3"}),a("div",null,[a("div",Ae,v(y.display_name),1),a("div",He,v(y.name),1)])])]),a("td",Ke,[a("div",Ge,v(y.description||"No description"),1)]),a("td",Je,[a("div",Qe,v(((l=y.permissions)==null?void 0:l.length)||0),1)]),a("td",We,[a("span",{class:D([y.is_system?"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400":"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400","inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},v(y.is_system?"System":"Custom"),3)]),a("td",Xe,[y.is_system?(r(),i("div",Ze," System role ")):(r(),i("div",Ye,[_(m,{variant:"edit",title:"Edit role",icon:"EditIcon",onClick:h=>e.editRole(y)},null,8,["onClick"]),_(m,{variant:"delete",title:"Delete role",icon:"DeleteIcon",onClick:h=>e.deleteRole(y)},null,8,["onClick"])]))])])}),128))]),empty:R(()=>[_(n,{class:"mx-auto h-12 w-12 text-gray-400"}),t[3]||(t[3]=a("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"No roles found",-1)),t[4]||(t[4]=a("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Create a role to get started. ",-1))]),_:1},8,["data","loading","error","onRetry"]),e.pagination?(r(),V(S,{key:0,pagination:e.pagination,"per-page":e.perPage,onPageChange:e.changePage,onPerPageChange:e.handlePerPageChange},null,8,["pagination","per-page","onPageChange","onPerPageChange"])):b("",!0),_(k,{show:e.showCreateRole||!!e.editingRole,role:e.editingRole,onClose:e.closeModal,onSaved:e.handleRoleSaved},null,8,["show","role","onClose","onSaved"])])}const dt=T(je,[["render",$e]]);export{dt as default};
